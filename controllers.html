<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Bluetooth Controller</title>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; user-select: none; }
        button { font-size: 18px; padding: 10px; margin: 10px; }
        #touchArea { width: 90vw; height: 50vh; background: lightgray; margin: 20px auto; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <h2>🎮 Mobile Controller</h2>
    <p id="status">Not connected</p>
    <button onclick="connectBluetooth()">🔗 Connect to TV</button>
    
    <div id="touchArea">Touch Here</div>

    <br>
    <button onclick="sendAction('move_left')">⬅️ Move Left</button>
    <button onclick="sendAction('move_right')">➡️ Move Right</button>
    <button onclick="sendAction('jump')">🆙 Jump</button>

    <script>
        let bluetoothDevice;
        let characteristic;
        let startX, startY;

        async function connectBluetooth() {
            try {
                bluetoothDevice = await navigator.bluetooth.requestDevice({
                    acceptAllDevices: true,
                    optionalServices: ['generic_access']
                });

                const server = await bluetoothDevice.gatt.connect();
                const services = await server.getPrimaryServices();

                if (services.length === 0) {
                    alert("No Bluetooth services found on TV");
                    return;
                }

                const firstService = services[0]; 
                const characteristics = await firstService.getCharacteristics();
                characteristic = characteristics[0];

                document.getElementById("status").innerText = "✅ Connected to TV!";
            } catch (error) {
                console.error("Bluetooth Connection Failed:", error);
            }
        }

        async function sendAction(action) {
            if (!characteristic) {
                alert("❌ Not connected to TV!");
                return;
            }

            try {
                let encoder = new TextEncoder();
                await characteristic.writeValue(encoder.encode(action));
                console.log("📤 Sent:", action);
            } catch (error) {
                console.error("Failed to send action:", error);
            }
        }

        document.getElementById("touchArea").addEventListener("touchstart", function (event) {
            startX = event.touches[0].clientX;
            startY = event.touches[0].clientY;
        });

        document.getElementById("touchArea").addEventListener("touchend", function (event) {
            let endX = event.changedTouches[0].clientX;
            let endY = event.changedTouches[0].clientY;
            let diffX = endX - startX;
            let diffY = endY - startY;

            if (Math.abs(diffX) > Math.abs(diffY)) {
                if (diffX > 30) {
                    sendAction("move_right");
                } else if (diffX < -30) {
                    sendAction("move_left");
                }
            } else {
                if (diffY < -30) {
                    sendAction("jump");
                }
            }
        });
    </script>

</body>
</html>
